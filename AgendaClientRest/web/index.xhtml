<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html">
  <h:head></h:head>
  <h:body>
    <script type="text/javascript">
      function handleClientLoad() {
        gapi.load('client:auth2', initClient);
      }

      function initClient() {
        gapi.client.init({
            apiKey: 'AIzaSyDLCymEwbiWgB67Ly9fvBECL8W8sw5ode8',
            discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/plus/v1/rest'],
            clientId: '208840706342-38re9h49c7jkco0agfo4r1h95cdf13bk.apps.googleusercontent.com',
            scope: 'email https://www.googleapis.com/auth/plus.me'
        }).then(function () {
          gapi.auth2.getAuthInstance().signIn();
          gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
        });
      }

      function updateSigninStatus(isSignedIn) {
        if (isSignedIn) {
          makeApiCall();
        }else{
        }
      }

      function handleSignInClick(event) {
        gapi.auth2.getAuthInstance().signIn();
      }

      function handleSignOutClick(event) {
        gapi.auth2.getAuthInstance().signOut();
      }

      function makeApiCall() {
        var request = gapi.client.plus.people.get({ 
            'userId' : 'me'
        });
        request.execute(function(resp) {
        var primaryEmail = resp.emails[0].value;
        document.getElementById('form:hi').value = primaryEmail;
        document.getElementById('form:hh').click();
        console.log('ID: ' + resp.id);
        console.log('Display Name: ' + resp.displayName);
        console.log('Email: ' + primaryEmail);
        console.log('JSON Profile: ' + JSON.stringify(resp));
        });  
      }
    </script>
    <script src="https://apis.google.com/js/api.js"
      onload="this.onload=function(){};handleClientLoad()"
      onreadystatechange="if (this.readyState === 'complete') this.onload()">
    </script>
    <h:form id="form">
        <h:inputHidden id="hi" value="#{agendaRestManagedBean.email}" ></h:inputHidden>
        <h:commandLink id="hh" action="#{agendaRestManagedBean.googleSignIn()}" style="display:none"/>
    </h:form>
    <h:button id="signin-button" onclick="handleSignInClick()">Sign In</h:button>
    <h:button id="signout-button" onclick="handleSignOutClick()">Sign Out</h:button>
  </h:body>
</html>
